//const base = 'https://conduit.productionready.io/api';
// const base = 'https://my-rw-api.herokuapp.com/api';
 const base = 'http://127.0.0.1:3000/api';
var axios = require('axios')

function send({ method, path, data, token }) {
	const fetch = process.browser ? window.fetch : require('node-fetch').default;

	const opts = { method,         headers: {
			'Content-Type': 'application/json',
			'Accept': 'application/json',
			'Access-Control-Allow-Origin':'true'
		}};

	if (data) {
		opts.headers['Content-Type'] = 'application/json';
		opts.body = JSON.stringify(data);
		console.log("opt.body=",opts.body);
	}

	if (token) {
		opts.headers['Authorization'] = `Token ${token}`;
	}

	return fetch(`${base}/${path}`, opts)
		.then(function(response) {
			if (!response.ok) {
				throw new Error("HTTP error, status = " + response.status);
			}
			return response.text();
		})
		.then(json => {
			try {
				return JSON.parse(json);
			} catch (err) {
				return json;
			}
		})
		.catch(function(error) {
			console.log("error.message=",error.message);
			return error.message;
		});
// No good
// 	return   axios(`${base}/${path}`, opts)
// 		.then(function (response) {
// 			console.log(JSON.stringify(response.data));
// 			return JSON.stringify(response.data);
// 		})
// 		.catch(function (error) {
// 			console.log(error);
// 		});
}

export function get(path, token) {
	return send({ method: 'GET', path, token });
}

export function del(path, token) {
	return send({ method: 'DELETE', path, token });
}

export function post(path, data, token) {
	return send({ method: 'POST', path, data, token });
}

export function put(path, data, token) {
	return send({ method: 'PUT', path, data, token });
}
